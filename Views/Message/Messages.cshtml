@model MessageModel

<div>
    <h1 class="text-center">Welcome, @Model.User.FirstName @Model.User.LastName</h1>
    <script>
    function updateTime() {
        var elements = document.getElementsByClassName("time-elapsed");
        for (var i = 0; i < elements.length; i++) {
            var postedAt = elements[i].getAttribute("data-posted-at");
            var timeElapsed = new Date() - new Date(postedAt);
            var seconds = Math.floor(timeElapsed / 1000);
            var minutes = Math.floor(seconds / 60);
            var hours = Math.floor(minutes / 60);
            var days = Math.floor(hours / 24);
            seconds = seconds % 60;
            minutes = minutes % 60;
            hours = hours % 24;
            elements[i].innerHTML = days + " days " + hours + " hours " + minutes + " minutes " + seconds + " minutes ago";
        }
    }
    setInterval(updateTime, 1000);
    </script>

    @await Html.PartialAsync("_AddMessage", Model.Message)
</div>
<div class="">
    @foreach (Message m in Model.AllMessages)
    {

        <div class="border border-dark rounded mt-3 shadow">
            
            <p class="mt-2 ms-2">Posted by: @m.User.FirstName </p>
            <p class="ms-2 time-elapsed" data-posted-at="@m.CreatedAt" id="timer"></p>
            <div class="d-flex justify-content-center mt-3">

                <h3 class="text-center">@m.MessageText</h3>
                @if (m.UserId == Model.User.UserId)
                {
                    <div>
                        <form asp-action="DestroyMessage" asp-controller="Message" asp-route-messageId="@m.MessageId"
                    method="post">
                            <input type="submit" value="Delete" class="btn">
                        </form>
                    </div>
                }
            </div>
            <div class="border-top border-secondary m-3"></div>
            <div class="">
                <h5 class="text-center">Comments</h5>
                @foreach (Comment c in Model.UserComments)
                {
                    if (c.Message.MessageId == m.MessageId)
                    {
                        <div class="m-3">
                            <h4>@c.CommentText</h4>
                            <p>By: @c.User.FirstName</p>

                        </div>

                    }

                }

                @{
                    Comment comment = new Comment()
                    {
                        MessageId = m.MessageId
                    };
                    @await Html.PartialAsync("_AddComment", comment)
                }
            </div>
        </div>
    }
</div>
<script>
    window.setInterval('refresh()', 1000);
</script>
